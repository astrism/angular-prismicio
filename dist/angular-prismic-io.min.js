/**
 * Component for using AngularJS with prismic.io
 * @version v0.1.0 - 2014-01-08
 * @link 
 * @author Arjan Wulder <arjanwulder@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";!function(){var a=angular.module("prismic.io",[]);a.provider("Prismic",function(){var a={};a.init=function(a,b){a.configuration=b,b.apiEndPoint=_.isUndefined(b.apiEndPoint)?"":b.apiEndPoint,a.setApiEndPoint=function(a){b.apiEndPoint=a},b.accessToken=_.isUndefined(b.accessToken)?"":b.accessToken,a.setAccessToken=function(a){b.accessToken=a},b.clientId=_.isUndefined(b.clientId)?"":b.clientId,a.setClientId=function(a){b.clientId=a},b.clientSecret=_.isUndefined(b.clientSecret)?"":b.clientSecret,a.setClientSecret=function(a){b.clientSecret=a},b.linkResolver=_.isUndefined(b.linkResolver)?angular.noop:b.linkResolver,a.setLinkResolver=function(a){b.linkResolver=a}};var b={};a.init(this,b),this.$get=["$window","$http","$q",function(c,d,e){function f(b){function d(a){o.Api(b.apiEndPoint,a,b.accessToken,b.requestHandler)}function f(a,c){d(function(d){var e={ref:a||d.data.master.ref,api:d,maybeRef:a&&a!==d.data.master.ref?a:"",maybeRefParam:a&&a!==d.data.master.ref?"&ref="+a:"",oauth:function(){return{accessToken:b.accessToken,hasPrivilegedAccess:!!b.accessToken}},linkResolver:b.linkResolver};c(e)})}function g(a){f(p.ref,function(b){a.call(c,b)})}function h(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))};b=e.exec(a);)c[f(b[1])]=f(b[2]);return c}function i(){var a=e.defer();return g(function(b){b.api.form("everything").ref(b.ref).submit(function(b){a.resolve(b)})}),a.promise}function j(a){var b=e.defer();return g(function(c){c.api.forms("everything").ref(c.ref).query(a).submit(function(a){b.resolve(a)})}),b.promise}function k(a){var b=e.defer();return g(function(c){c.api.forms("everything").ref(c.ref).query('[[:d = at(document.id, "'+a+'")]]').submit(function(a){b.resolve(_.first(a))})}),b.promise}function l(a){var b=e.defer();return a&&a.length&&g(function(c){c.api.forms("everything").ref(c.ref).query("[[:d = any(document.id, ["+_(a).map(function(a){return'"'+a+'"'}).join(",")+"])]]").submit(function(a){b.resolve(a)})}),b.promise}function m(a){var b=e.defer();g(function(c){c.api.bookmarks[a].submit(function(a){b.resolve(_.first(a))})});var c=b.promise;c.then(function(a){return k(a)})}var n={},o=c.Prismic,p=h(c.location.search.substring(1));return a.init(n,b),n.all=_.bind(i,n),n.query=_.bind(j,n),n.document=_.bind(k,n),n.documents=_.bind(l,n),n.bookmark=_.bind(m,n),n}return f(b)}]})}();